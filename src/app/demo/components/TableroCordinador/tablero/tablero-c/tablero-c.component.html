<div class="grid">
	<div class="col-12">
		<div class="card">
			<h5>Grupos de Actividades</h5>
			<p-toast></p-toast>
			<p-confirmPopup></p-confirmPopup>
			<button pButton label="Crear Nuevo Grupo" icon="pi pi-plus" (click)="displayModal = true"
				class="mb-3 p-button-success"></button>
			<p-table [value]="taskGroups" dataKey="id" rowGroupMode="subheader" [groupRowsBy]="['name']"
				responsiveLayout="scroll">
				<ng-template pTemplate="header">
					<tr>
						<th>Nombre del Grupo</th>
						<th>Fecha de Inicio</th>
						<th>Fecha de Fin</th>
						<th>Acciones</th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-group let-rowIndex="rowIndex">
					<tr class="mb-2">
						<td>{{ group.name }}</td>
						<td>{{ group.startdate | date }}</td>
						<td>{{ group.enddate | date }}</td>
						<td>
							<div class="flex align-items-center">
								<button pButton
									(click)="expandedRows[group.name] = !expandedRows[group.name]; loadActivities(group.idgrouptaskcl)"
									[label]="expandedRows[group.name] ? 'Ocultar Actividades' : 'Mostrar Actividades'"
									icon="pi pi-chevron-down" class="mr-2"></button>
								<button pButton label="Modificar" icon="pi pi-pencil" (click)="openEditModal(group)"
									class="mr-2 p-button-warning"></button>

								<button pButton label="Eliminar" icon="pi pi-trash" (click)="deleteGroup(group, $event)"
									class="p-button-danger"></button>
							</div>
						</td>
					</tr>
					<tr *ngIf="expandedRows[group.name]">
						<td colspan="5">
							<div class="card">
								<h6>Actividades</h6>
								<p-table [value]="activities" dataKey="id" responsiveLayout="scroll">
									<ng-template pTemplate="header">
					<tr>
						<th>Nombre</th>
						<th>Descripción</th>
						<th>Fecha de Fin</th>
						<th>Importante</th>
						<th>Etiqueta</th>
						<th>Acciones</th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-activity>
					<tr>
						<td>{{ activity.nameT }}</td>
						<td>{{ activity.descriptionT }}</td>
						<td>{{ activity.end_date | date }}</td>
						<td>{{ activity.important === 1 ? 'Sí' : 'No' }}</td>
						<td>
							<span 
								[ngStyle]="{'background-color': activity.label.colorL, 'color': 'white'}" class="label-button">
								{{ activity.label.nameL }}
							</span>
						</td>
						<td>
							<button pButton label="Modificar" icon="pi pi-pencil"
								(click)="openEditModalAct(activity)" class="mr-2 p-button-warning"></button>
							<button pButton label="Eliminar" icon="pi pi-trash"
								(click)="deleteActivity(activity.idactivitycl, $event)"
								class="p-button-danger"></button>
						</td>
					</tr>
				</ng-template>
			</p-table>
			<div class="card mt-6">
				<h6>Agregar Actividad</h6>
				<div class="formgrid grid">
					<div class="field col-12 md:col-4">
						<label for="activityName" style="width: 100%">Nombre de la Actividad:</label>
						<input id="activityName" [(ngModel)]="newActivity.nameT" pInputText
							placeholder="Nombre de la Actividad" class="w-full" />
					</div>
					<div class="field col-12 md:col-4">
						<label for="activityDescription" style="width: 100%">Descripción de la Actividad:</label>
						<input id="activityDescription" [(ngModel)]="newActivity.descriptionT" pInputText
							placeholder="Descripción de la Actividad" class="w-full" />
					</div>

					<div class="field col-12 md:col-4">
						<label for="activityEndDate" style="width: 100%">Fecha de Fin:</label>
						<p-calendar id="activityEndDate" [(ngModel)]="newActivity.end_date" [showIcon]="true"
							[appendTo]="'body'"  [minDate]="minDate" class="w-full"></p-calendar>
					</div>

					<div class="field col-12 md:col-4">
						<label for="activityImportant" style="width: 100%;">Importante:</label>
						<p-dropdown id="activityImportant" [(ngModel)]="newActivity.important"
							[options]="importanceOptions" placeholder="Seleccione una opción" class="w-full"
							appendTo="body"></p-dropdown>
					</div>

					<div class="field col-12 md:col-4">
						<label for="activityLabel" style="width: 100%">Etiqueta:</label>
						<select id="activityLabel" [(ngModel)]="newActivity.idLabel" class="w-full" pInputText>
							<option *ngFor="let label of labels" [value]="label.idLabel"
								[ngStyle]="{'background-color': label.colorL, 'color': '#fff'}">
								{{ label.nameL }}
							</option>
						</select>
					</div>
					<div class="field col-12 md:col-4" >
						<label for="activityLabel" style="width: 100%">Nueva Etiqueta:</label>
						<button pButton label="Crear Etiqueta" icon="pi pi-plus"
							class="w-full p-button-secondary"></button>
					</div>
				</div>
				<div class="flex justify-content-end">
					<button pButton label="Agregar"
						(click)="logGroupId(group.idgrouptaskcl); addActivity(group.idgrouptaskcl)" icon="pi pi-plus"
						class="p-button-success"></button>
				</div>
			</div>
		</div>
		</td>
		</tr>
		</ng-template>
		</p-table>



	</div>
</div>
</div>

<p-dialog header="Crear Nuevo Grupo" [(visible)]="displayModal" [modal]="true" [style]="{ width: '50vw' }"
	[draggable]="false" [resizable]="false">
	<div class="formgrid grid">
		<div class="field col-12 md:col-4">
			<label for="groupName">Nombre del Grupo:</label>
			<input id="groupName" [(ngModel)]="newGroup.name" pInputText placeholder="Nombre del Grupo"
				class="w-full" />
		</div>
		<div class="field col-12 md:col-4">
			<label for="startDate">Fecha de Inicio:</label>
			<p-calendar id="startDate" [(ngModel)]="newGroup.startdate" [showIcon]="true" [appendTo]="'body'"
				class="w-full" [minDate]="minDate"></p-calendar>
		</div>
		<div class="field col-12 md:col-4">
			<label for="endDate">Fecha de Fin:</label>
			<p-calendar id="endDate" [(ngModel)]="newGroup.enddate" [showIcon]="true" [appendTo]="'body'" class="w-full"
				[minDate]="minDate"></p-calendar>
		</div>
	</div>
	<p-footer>
		<button pButton label="Cancelar" icon="pi pi-times" (click)="displayModal = false"
			class="p-button-danger"></button>
		<button pButton label="Crear" icon="pi pi-check" (click)="createGroup()" class="p-button-success"></button>
	</p-footer>
</p-dialog>

<p-dialog header="Modificar Grupo de Actividades" [(visible)]="visible" [modal]="true" [style]="{ width: '50vw' }"
	[draggable]="false" [resizable]="false">
	<div class="formgrid grid">
		<div class="field col-12 md:col-4">
			<label for="editGroupName">Nombre del Grupo:</label>
			<input id="editGroupName" [(ngModel)]="selectedGroup.name" pInputText placeholder="Nombre del Grupo"
				class="w-full" />
		</div>

		<div class="field col-12 md:col-4">
			<label for="editStartDate">Fecha de Inicio:</label>
			<p-calendar id="editStartDate" [(ngModel)]="selectedGroup.startdate" [showIcon]="true" [appendTo]="'body'"
				class="w-full" [minDate]="minDate"></p-calendar>
		</div>

		<div class="field col-12 md:col-4">
			<label for="editEndDate">Fecha de Fin:</label>
			<p-calendar id="editEndDate" [(ngModel)]="selectedGroup.enddate" [showIcon]="true" [appendTo]="'body'"
				class="w-full" [minDate]="minDate"></p-calendar>
		</div>
	</div>

	<p-footer>
		<button pButton label="Cancelar" icon="pi pi-times" (click)="visible = false" class="p-button-danger"></button>
		<button pButton label="Modificar" icon="pi pi-check" (click)="updateGroup()" class="p-button-success"></button>
	</p-footer>
</p-dialog>
<p-dialog header="Modificar Actividad" [(visible)]="actividades" [modal]="true" [style]="{ width: '50vw' }"
    [draggable]="false" [resizable]="false">
    <div class="formgrid grid">
        <div class="field col-12 md:col-4">
            <label for="activityName">Nombre de la actividad:</label>
            <input id="activityName" [(ngModel)]="selectAct.nameT" pInputText placeholder="Nombre de la Actividad"
                class="w-full" />
        </div>

        <div class="field col-12 md:col-4">
            <label for="activityImportant">Importante:</label>
            <p-dropdown id="activityImportant" [(ngModel)]="selectAct.important"
                [options]="importanceOptions" placeholder="Seleccione una opción" class="w-full"
                appendTo="body"></p-dropdown>
        </div>

        <div class="field col-12 md:col-4">
            <label for="endDate">Fecha de Fin:</label>
            <p-calendar id="endDate" [(ngModel)]="selectAct.end_date" [showIcon]="true" [appendTo]="'body'"
                class="w-full" [minDate]="minDate"></p-calendar>
        </div>

        <div class="field col-12 md:col-6">
            <label for="activityLabel">Etiqueta:</label>
            <select id="activityLabel" [(ngModel)]="selectAct.idLabel" class="w-full" pInputText>
                <option *ngFor="let label of labels" [value]="label.idLabel"
                    [ngStyle]="{'background-color': label.colorL, 'color': '#fff'}">
                    {{ label.nameL }}
                </option>
            </select>
        </div>

        <div class="field col-12 md:col-6">
            <label for="activityDescription">Descripción:</label>
            <input id="activityDescription" [(ngModel)]="selectAct.descriptionT" pInputText placeholder="Descripción"
                class="w-full" />
        </div>
    </div>

    <p-footer>
        <button pButton label="Cancelar" icon="pi pi-times" (click)="actividades = false"
            class="p-button-danger"></button>
        <button pButton label="Modificar" icon="pi pi-check" (click)="updateActivity()" class="p-button-success"></button>
    </p-footer>
</p-dialog>